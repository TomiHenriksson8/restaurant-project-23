(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();const u="https://student-restaurants.azurewebsites.net/api/v1",N="https://student-restaurants.azurewebsites.net/uploads/",H={enableHighAccuracy:!0,timeout:5e3,maximumAge:0},m=async(e,t={})=>{const n=await fetch(e,t);if(!n.ok)throw new Error(`Error ${n.status} occurred`);const a=await n.json(),o=localStorage.getItem("favoriteRestaurant");return o&&console.log("Your favorite restaurant is:",JSON.parse(o)),a};async function O(e,t){document.querySelectorAll(".highlight").forEach(s=>{s.classList.remove("highlight")}),t.classList.add("highlight"),l.innerHTML="";const a=async s=>{let r;try{s==="daily"?r=await m(u+`/restaurants/daily/${e._id}/fi`):r=await m(u+`/restaurants/weekly/${e._id}/fi`);const c=z(e,r,s);l.innerHTML=c}catch{}o()},o=()=>{document.getElementById("dailyMenu")?.addEventListener("click",()=>a("daily")),document.getElementById("weeklyMenu")?.addEventListener("click",()=>a("weekly"))};a("daily"),l.showModal()}const J=e=>{const t=localStorage.getItem("favoriteRestaurants");let n=[];if(t&&(n=JSON.parse(t),n.some(a=>a._id===e._id))){alert(`${e.name} is already one of your favorite restaurants.`);return}n.push(e),localStorage.setItem("favoriteRestaurants",JSON.stringify(n)),alert(`${e.name} has been added to your favorite restaurants.`),L()},_=e=>{const t=localStorage.getItem("favoriteRestaurants");if(!t)return;const a=JSON.parse(t).filter(o=>o._id!==e);localStorage.setItem("favoriteRestaurants",JSON.stringify(a)),L()},j=e=>{const{name:t,address:n,company:a}=e,o=document.createElement("tr"),s=document.createElement("td");s.innerText=t;const r=document.createElement("td");r.innerText=n;const c=document.createElement("td");c.classList.add("restaurant-group"),c.innerText=a;const h=document.createElement("td"),i=document.createElement("button");return i.innerText="Favorite",i.classList.add("favorite-btn"),i.onclick=()=>J(e),h.appendChild(i),o.appendChild(s),o.appendChild(r),o.appendChild(c),o.appendChild(h),o},z=(e,t,n)=>{const{name:a,address:o,city:s,postalCode:r,phone:c,company:h}=e;let i=`
      <h3>${a}</h3>
      <p>${h}</p>
      <p>${o} ${r} ${s}</p>
      <p>${c}</p>
      <!-- Adding the buttons here -->
      <div class="menu-buttons">
          <button id="dailyMenu">Daily Menu</button>
          <button id="weeklyMenu">Weekly Menu</button>
      </div>
      <!-- Placeholders for both daily and weekly menus -->
      <div id="dailyMenuContent" style="display:${n==="daily"?"block":"none"};">
          <table>
              <tr>
                  <th>Course</th>
                  <th>Diet</th>
                  <th>Price</th>
              </tr>
  `;return n==="daily"&&t.courses&&t.courses.forEach(v=>{const{name:w,diets:S,price:b}=v;i+=`
              <tr>
                  <td>${w}</td>
                  <td>${S??" - "}</td>
                  <td>${b??" - "}</td>
              </tr>
          `}),i+="</table></div>",i+=`
      <div id="weeklyMenuContent" style="display:${n==="weekly"?"block":"none"};">
          <table>
              <tr>
                  <th>Course</th>
                  <th>Diet</th>
                  <th>Price</th>
              </tr>
  `,n==="weekly"&&t.days&&t.days.forEach(v=>{i+=`<h4>${v.date}</h4>`,v.courses.forEach(w=>{const{name:S,diets:b,price:A}=w;i+=`
                  <tr>
                      <td>${S}</td>
                      <td>${b??" - "}</td>
                      <td>${A??" - "}</td>
                  </tr>
              `})}),i+="</table></div>",i},L=()=>{const e=localStorage.getItem("favoriteRestaurants"),t=document.getElementById("favorites-section");if(t&&(t.innerHTML=""),e&&t){const n=JSON.parse(e);if(n.length===0){t.style.display="none";return}else t.style.display="flex";const a=document.createElement("h3");a.innerText="Favorite Restaurants:",t.appendChild(a),n.forEach(o=>{const s=document.createElement("button");s.innerText=o.name,s.classList.add("restaurant-button"),s.onclick=c=>{c.stopPropagation(),O(o,s)};const r=document.createElement("button");r.innerText="X",r.classList.add("remove-button"),r.onclick=c=>{c.stopPropagation(),_(o._id)},s.appendChild(r),t.appendChild(s)})}};let f=[];async function G(){f=await m(u+"/restaurants"),y(f),document.getElementById("search")?.addEventListener("click",()=>{const e=document.getElementById("search-input").value.toLowerCase(),t=f.filter(n=>n.name.toLowerCase().includes(e));y(t)})}const l=document.getElementById("restaurantModal");if(!l)throw new Error("Modal not found");l.addEventListener("click",e=>{e.target===l&&l.close()});document.addEventListener("keydown",e=>{e.key==="Escape"&&l.open&&l.close()});const M=(e,t,n,a)=>Math.sqrt((n-e)**2+(a-t)**2),K=(e,t)=>{t.addEventListener("click",()=>O(e,t))},y=e=>{const t=document.querySelector("table"),n=t?.getElementsByTagName("tr");n&&Array.from(n).slice(1).forEach(a=>a.remove()),e.forEach(a=>{const o=j(a);t?.appendChild(o),K(a,o)})},W=e=>{console.warn(`ERROR(${e.code}): ${e.message}`)},X=async e=>{const t=e.coords;f.sort((n,a)=>{const o=t.latitude,s=t.longitude,r=M(o,s,n.location.coordinates[1],n.location.coordinates[0]),c=M(o,s,a.location.coordinates[1],a.location.coordinates[0]);return r-c}),y(f),P(f)},P=e=>{document.querySelector("#sodexo")?.addEventListener("click",()=>{y(e.filter(t=>t.company==="Sodexo"))}),document.querySelector("#compass")?.addEventListener("click",()=>{y(e.filter(t=>t.company==="Compass Group"))}),document.querySelector("#reset")?.addEventListener("click",()=>{y(e)})},Y=()=>{document.querySelectorAll(".close-btn").forEach(t=>{t.addEventListener("click",n=>{const o=n.target.closest("dialog");o&&o.close()})})};document.addEventListener("DOMContentLoaded",async()=>{L(),await G(),P(f),Y(),navigator.geolocation.getCurrentPosition(X,W,H)});const d=document.getElementById("profileModal"),Q=document.querySelector(".user");Q.addEventListener("click",function(e){e.preventDefault(),d.showModal()});d.addEventListener("click",function(e){e.target===d&&d.close()});document.addEventListener("keydown",function(e){e.key==="Escape"&&d.open&&d.close()});const V=document.querySelector(".modal-content");V?.addEventListener("click",function(e){e.stopPropagation()});const Z=document.querySelector("#login-form"),ee=document.querySelector("#profile-form"),te=document.querySelector("#avatar-form"),I=document.querySelector("#username"),B=document.querySelector("#password"),E=document.querySelector("#profile-username"),k=document.querySelector("#profile-email"),T=document.querySelector("#avatar"),C=document.querySelector("#username-target"),R=document.querySelector("#email-target"),q=document.querySelector("#avatar-target"),ne=document.querySelector("#signUp-form"),D=document.querySelector("#signUp-username"),U=document.querySelector("#signUp-password"),$=document.querySelector("#signUp-email"),oe=async e=>{const t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)};return await m(u+"/auth/login",t)},ae=async(e,t)=>{const n=new FormData;n.append("avatar",e);const a={method:"POST",headers:{Authorization:"Bearer "+t},body:n};return await m(u+"/users/avatar",a)},se=async(e,t)=>{const n={method:"PUT",headers:{Authorization:"Bearer "+t,"Content-Type":"application/json"},body:JSON.stringify(e)};return await m(u+"/users",n)},F=e=>{!C||!R||!q||!k||!E||(C.innerHTML=e.username,R.innerHTML=e.email,q.src=N+e.avatar,k.value=e.email,E.value=e.username)},re=async e=>{const t={headers:{Authorization:"Bearer "+e}};return await m(u+"/users/token",t)},x=async()=>{const e=localStorage.getItem("token");if(!e)return;const t=await re(e);F(t)};x();Z?.addEventListener("submit",async e=>{if(e.preventDefault(),!I||!B)return;const t={username:I.value,password:B.value},n=await oe(t);console.log(n),localStorage.setItem("token",n.token),F(n.data)});ee?.addEventListener("submit",async e=>{if(e.preventDefault(),!E||!k)return;const t={username:E.value,email:k.value},n=localStorage.getItem("token");if(!n)return;const a=await se(t,n);console.log(a)});te?.addEventListener("submit",async e=>{if(e.preventDefault(),!T?.files)return;const t=T.files[0],n=localStorage.getItem("token");if(!n)return;const a=await ae(t,n);console.log(a),x()});const p=document.getElementById("signUpModal");document.getElementById("openSignUpModal")?.addEventListener("click",e=>{e.preventDefault(),d&&p&&(d.close(),p.showModal())});p?.addEventListener("click",e=>{e.target===p&&p.close()});document.addEventListener("keydown",e=>{e.key==="Escape"&&p.open&&p.close()});const ce=async e=>{const t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)};return await m(u+"/users",t)};ne?.addEventListener("submit",async e=>{if(e.preventDefault(),!D||!U||!$)return;const t={username:D.value,password:U.value,email:$.value},n=await ce(t);console.log(n),document.getElementById("feedbackModal").showModal()});const ie=document.getElementById("closeFeedbackModal");ie?.addEventListener("click",()=>{document.getElementById("feedbackModal").close()});const g=document.getElementById("feedbackModal");g?.addEventListener("click",e=>{e.target===g&&g.close()});document.addEventListener("keydown",e=>{e.key==="Escape"&&g.open&&g.close()});const le=document.getElementById("checkbox");le.addEventListener("change",()=>{document.body.classList.toggle("dark"),document.querySelectorAll(".dark-mode-target").forEach(t=>{t.classList.toggle("dark")})});
